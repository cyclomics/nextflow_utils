nextflow_process {

    name "Test Process seqkit SummerizeReadsStdout"
    script "reporting/modules/seqkit.nf"
    process "SummerizeReadsStdout"
    test("seqkit stats per barcode") {

        when {
            process {
                """
                sample_id = "test_sample"
                
                fq_file1_id = "abc01"
                fq_file2_id = "abc02"

                fq_file1 = file("$baseDir/example_datasets/example_native_reads/fastq_pass/FAW79986_pass_dbcafcd9_40623079_10.fastq.gz")
                fq_file2 = file("$baseDir/example_datasets/example_native_reads/fastq_pass/FAW79986_pass_dbcafcd9_40623079_8.fastq.gz")

                input[0] = Channel.of([sample_id, tuple(fq_file1_id, fq_file2_id), tuple(fq_file1,fq_file2)])
                """
            }
        }
        then {
            assert process.success
            // bulky but it works...
            assert process.out[0][0] == 'summarizing reads for__: test_sample\nExample file name______: FAW79986_pass_dbcafcd9_40623079_10.fastq.gz\nnumber of files________: 2\ncombined statistics for the sample:\nfile  format  type  num_seqs     sum_len  min_len  avg_len  max_len       Q1     Q2     Q3  sum_gap    N50  Q20(%)  Q30(%)  GC(%)\n-     FASTQ   DNA      8,000  31,078,276       50  3,884.8   25,494  2,439.5  3,402  4,802        0  4,417   80.97    62.1  45.42\n'
        }
    }
}
